
<div class="container">
  <div class="col-md-8 col-sm-offset-2">

    <div class="post-item">
    <% if @current_user %>
    <%if @current_user.id == @post.user_id%>
      <div class="dropdown option">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
         Tùy chọn <span class="caret">
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <li><a class="dropdown-item" href="#">Xem</a></li>
        <li><a class="dropdown-item" href="<%= edit_post_path(@post)%>">Sửa</a></li>
        <li><a class="dropdown-item " href="<%= post_path(@post)%> "data-method="delete" data-confirm="Bạn chắc chắn muốn xóa?">Xóa</a></li>
        </div>
      </div>
      <%end%>
    <%end%>
      <h3 class="text-danger"><span class="text-primary text-strong"><%= @post.user.name%>:</span> <%= @post.title %></h3>
    <div>
      <%= @post.content %>
    </div>
    <p class="view-like">
      <%= @post.likes.where(isLike: true).count %>
    </p>
    <div class="margin_bottom_10">
      <%if @current_user%>
        <%like = @post.likes.where(user_id: @current_user.id).first%>
        <button data-target="<%= like_api_v1_post_path(@post.id) %>"  data-method ="post" class="btn btn-primary post-like margin_bottom_20"><%= like.try(:isLike) ? "Không thích" : "Thích"%></button>

      <%else%>
        <button class="btn btn-primary return-login">Thích</button>
      <%end%>
    </div>


    <div class="col-md-6 margin_bottom_20">
      <!-- remote để send bằng ajax not submit -->
      <%= form_for([:api, :v1, Comment.new], remote: true)  do |f| %>
        <fieldtest>
        <%= f.text_area :content , class: "form-control margin_bottom_10 " , required: "required"%>
        <%= f.hidden_field :post_id, as: :hidden, value: @post.id %>
        <%= f.hidden_field :current_user, as: :hidden, value: @current_user %>
        <%if @current_user%>
          <button type="button"  class="btn btn-primary post-comment" >Bình luận</button>
        <%else%>
          <button type="button"  class="btn btn-primary return-login" >Bình luận</button>
        <%end%>
        </fieldtest>
      <% end %>

    </div>

    <div class="col-md-12">
      <ul class="list-comment list-unstyled ">
        <% @post.comments.each do |comment| %>
        <div class="comment-item">
          <li class="box-comment  col-md-12">

            <div class="col-md-6">
              <span class="text-primary text-strong"><%= comment.user.name %>:</span> <%= comment.content %>
              <div class=" col-md-12 margin_bottom_20 box-replies">
                <a class="reply-comment" data-target="<%=comment.id%>" >trả lời</a>
                <div class="replies"></div>
              </div>

            </div>

            <div class="col-md-6">
            <% if @current_user%>
              <%if @current_user.id == comment.user.id%>
                <button data-target="<%= comment.id %>" class="btn btn-danger delete-comment"  >Xóa</button>
              <%end%>
            <%end%>
            </div>
          </li>
        </div>
        <% end%>
      </ul>
    </div>

    </div>
  </div>
</div>
